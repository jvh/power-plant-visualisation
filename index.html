<!DOCTYPE html>
<html lang="en">

<!-- 
    Jonathan Harper coursework submission

    Sources:
        Website bootstrap: https://colorlib.com
        Visualisation base tool used: https://d3js.org/
        Website icon: https://www.iconfinder.com/icons/1925741/cable_charge_electric_electric_plug_electricity_icon
        Map visualisation base: https://vida.io/gists/KuoWAKajdT7Q5q3Lt 
-->


<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 4 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- Title -->
    <title>Power Plant Visualisations</title>

    <!-- Favicon, image found at https://www.iconfinder.com/icons/1925741/cable_charge_electric_electric_plug_electricity_icon -->
    <link rel="icon" href="img/core_img/website_icon.png">

    <!-- Core Stylesheet -->
    <link href="style.css" rel="stylesheet">

    <!-- Responsive CSS -->
    <link href="css/responsive.css" rel="stylesheet">

    <!-- Imports -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="//d3js.org/topojson.v1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

</head>

<!-- CSS Style (obtained from https://vida.io/gists/KuoWAKajdT7Q5q3Lt) -->
<style>   
    /* Obtained from https://html.com/paragraphs/ */
    .indented {
        padding-left: 50pt;
        padding-right: 50pt;
    }
    
    #canvas {
    }
    
    #canvas-svg {
    }

    .land {
        fill: #222;
    }
    
    .boundary {
        fill: none;
        stroke: #fff;
        stroke-width: 1px;
    }
    
    #tooltip-container {
        position: absolute;
        background-color: #fff;
        color: #000;
        padding: 10px;
        border: 1px solid;
        display: none;
    }
    
    .tooltip_key {
        font-weight: bold;
    }
    
    .tooltip_value {
        margin-left: 20px;
        float: right;
    }

    .background {
        fill: none;
        pointer-events: all;
    }

    #states {
        fill: #aaa;
    }

    #state-borders {
    fill: none;
    stroke: #fff;
    stroke-width: 1.5px;
    stroke-linejoin: round;
    stroke-linecap: round;
    pointer-events: none;
    }
        
</style>

<body>
    <!-- ***** Preloader ***** -->
    <div id="preloader">
        <div class="colorlib-load"></div>
    </div>

    <!-- ***** Header Area ***** -->
    <header class="header_area animated">
        <div class="container-fluid">
            <div class="row align-items-center">
                <!-- Menu Area Start -->
                <div class="col-12 col-lg-10">
                    <div class="menu_area">
                        <nav class="navbar navbar-expand-lg navbar-light">
                            <!-- Logo -->
                            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ca-navbar" aria-controls="ca-navbar" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                            <!-- Menu Area -->
                            <div class="collapse navbar-collapse" id="ca-navbar">
                                <ul class="navbar-nav ml-auto" id="nav">
                                    <li class="nav-item"><a class="nav-link" href="#about">About</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#features">Data Preprocessing</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#screenshot">Visualisation 1</a></li>
                                    
                                </ul>
                                <div class="sing-up-button d-lg-none">
                                    <a href="#">Sign Up Free</a>
                                </div>
                            </div>
                        </nav>
                    </div>
                </div>
                
            </div>
        </div>
    </header>


    <!-- ***** Welcome Area ***** -->
    <section class="wellcome_area clearfix" id="home">
        <div class="container h-100">
            <div class="row h-100 align-items-center">
                <div class="col-12 col-md">
                    <div class="wellcome-heading">
                        <h2>Power Plant Visualisations</h2>
                        <p>Cleaning and Visualising Data by Jonathan Harper</p>
                    </div>
                    
                </div>
            </div>
        </div>
    </section>


    <!-- ***** About Area ***** -->
    <section class="special-area bg-white section_padding_100" id="about">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <!-- Section Heading Area -->
                    <div class="section-heading text-center">
                        <h2>About</h2>
                        <div class="line-shape"></div>
                    </div>
                </div>
            </div>

            <div class="row">
            	<div class="col-12">
	            	<h1>Dataset </h1>
                    This webpage discusses the cleaning and subsequent visualisation of a power plant dataset which covers most of Europe, Asia, Africa, and South America. This webpage aims to graphically represent the distribution of power plants across the globe. This data is primarily intended for those who want an overview into the production of energy through power plants per country. The dataset itself is limited and incomplete, often omitting many of the quantitative data (such as the energy generation per year), for this reason it may not be suitable for professionals who want a deeper insight into the activities of individual power plants; instead, this dataset is intended for a more casual environmentally-conscience audience looking for a general insight into the production per country/continent whom would do further research with more complete datasets if interested.

	            	<h1>Dataset </h1>
	            	<p>This dataset represents power plants across the globe, with a few exclusions including the entirety of North America. The dataset includes information regarding the fuel used, energy produced (in gwh), name, and location. The original dataset has a number of inconsistencies in its format which not only affect readability, but also processing. Because of this, the data had to undergo a 'cleaning' stage where these errors were addressed and fixed where possible.</p>
                    <p>The data has been categorised into 'Renewable', 'Non-Renewable', 'and 'Other' according to the main fuel type used by the power plant (represented as 'fuel1' in the dataset). Renewable energies are those which come from renewable sources which are regularly replenished and don't require vast amounts of time. Non-renewable energy encompasses energy which originates from sources which are non-renewable, that is it exceeds the human lifetime to be replenished. Finally, we categorise 'Other' as being power plants which consume an 'other' fueltype as defined in the dataset and those power plants whose primary fuel is 'waste' -- as argued by <a href="url">https://www.renewableenergyworld.com/ugc/articles/2009/09/is-wastetoenergy-renewable.html</a>, waste fits into neither renewable or non-renewable. For this reason it seems appropriate to classify this as being 'Other' as this is entirely dependent on the type of waste being used, the method of using the waste, etc.; this is done on a plant-by-plant basis and this data is not available with the current dataset.</p>   
                    <p>We have classified the primary fuel types according to the following specification:</p>
                    <p>
                    <b>Renewable</b><br />
                    <ul style="list-style-type:square;">
                            <li>Biomass</li>
                            <li>Geothermal</li>
                            <li>Hydro</li>
                            <li>Solar</li>
                          </ul>
        


                    </p>

                    Non-Renewable
                        Coal
                        Gas
                        Oil
                        Nuclear
                        Wind

                    Other
                        Other
                        Waste

	            	<h1>Dataset </h1>
	            	blh
            	</div>
            </div>
        </div>
    </section>


    
    <!-- ***** Visualisation Map (body obtained from https://vida.io/gists/KuoWAKajdT7Q5q3Lt) ***** -->
    <section class="special-area bg-white section_padding_100" id="about">
        <div class="container">
            <!-- ***** Heading ***** -->
            <div class="row"> 
                <div class="col-12">
                    <!-- Section Heading Area -->
                    <div class="section-heading text-center">
                        <h2>Visualisation 1</h2>
                        <div class="line-shape"></div>
                    </div>
                </div>
            </div>
            
            <div id="tooltip-container"></div>
            <div class="checkmarks" id="canvas-svg">
                <form action="/action_page.php">
                    <span style="padding-right:5px"><input type="checkbox" name="Renewable" class='filter_button' id='isselected1' value="Renewable" checked> Renewable</span><span class="dot green"></span>
                    <span style="padding-right:5px; padding-left:20px; "><input type="checkbox" name="Non-Renewable" class='filter_button' id='isselected2' value="Non-Renewable" checked>Non-Renewable</span><span class="dot red"></span>
                    <span style="padding-right:5px;  padding-left:20px; "><input type="checkbox" name="Other" class='filter_button' id='isselected3' value="Other" checked>Other</span><span class="dot blue"></span>
                </form>


            </div>
            
                    <script>

                        // Stores a list of the country codes and their corresponding country names
                        // onchange="filterSites(this)"
                        var country_codes = {
                            "AFG": "Afghanistan",
                            "ALA": "Aland Islands",
                            "ALB": "Albania",
                            "DZA": "Algeria",
                            "ASM": "American Samoa",
                            "AND": "Andorra",
                            "AGO": "Angola",
                            "AIA": "Anguilla",
                            "ATA": "Antarctica",
                            "ATG": "Antigua and Barbuda",
                            "ARG": "Argentina",
                            "ARM": "Armenia",
                            "ABW": "Aruba",
                            "AUS": "Australia",
                            "AUT": "Austria",
                            "AZE": "Azerbaijan",
                            "BHS": "Bahamas",
                            "BHR": "Bahrain",
                            "BGD": "Bangladesh",
                            "BRB": "Barbados",
                            "BLR": "Belarus",
                            "BEL": "Belgium",
                            "BLZ": "Belize",
                            "BEN": "Benin",
                            "BMU": "Bermuda",
                            "BTN": "Bhutan",
                            "BOL": "Bolivia",
                            "BES": "Bonaire",
                            "BIH": "Bosnia and Herzegovina",
                            "BWA": "Botswana",
                            "BVT": "Bouvet Island",
                            "BRA": "Brazil",
                            "IOT": "British Indian Ocean Territory",
                            "VGB": "British Virgin Islands",
                            "BRN": "Brunei",
                            "BGR": "Bulgaria",
                            "BFA": "Burkina Faso",
                            "BDI": "Burundi",
                            "KHM": "Cambodia",
                            "CMR": "Cameroon",
                            "CAN": "Canada",
                            "CPV": "Cape Verde",
                            "CYM": "Cayman Islands",
                            "CAF": "Central African Republic",
                            "TCD": "Chad",
                            "CHL": "Chile",
                            "CHN": "China",
                            "CXR": "Christmas Island",
                            "CCK": "Cocos Islands",
                            "COL": "Colombia",
                            "COM": "Comoros",
                            "COK": "Cook Islands",
                            "CRI": "Costa Rica",
                            "HRV": "Croatia",
                            "CUB": "Cuba",
                            "CUW": "Curacao",
                            "CYP": "Cyprus",
                            "CZE": "Czech Republic",
                            "COD": "Democratic Republic of the Congo",
                            "DNK": "Denmark",
                            "DJI": "Djibouti",
                            "DMA": "Dominica",
                            "DOM": "Dominican Republic",
                            "TLS": "East Timor",
                            "ECU": "Ecuador",
                            "EGY": "Egypt",
                            "SLV": "El Salvador",
                            "GNQ": "Equatorial Guinea",
                            "ERI": "Eritrea",
                            "EST": "Estonia",
                            "ETH": "Ethiopia",
                            "FLK": "Falkland Islands",
                            "FRO": "Faroe Islands",
                            "FJI": "Fiji",
                            "FIN": "Finland",
                            "FRA": "France",
                            "GUF": "French Guiana",
                            "PYF": "French Polynesia",
                            "ATF": "French Southern Territories",
                            "GAB": "Gabon",
                            "GMB": "Gambia",
                            "GEO": "Georgia",
                            "DEU": "Germany",
                            "GHA": "Ghana",
                            "GIB": "Gibraltar",
                            "GRC": "Greece",
                            "GRL": "Greenland",
                            "GRD": "Grenada",
                            "GLP": "Guadeloupe",
                            "GUM": "Guam",
                            "GTM": "Guatemala",
                            "GGY": "Guernsey",
                            "GIN": "Guinea",
                            "GNB": "Guinea-Bissau",
                            "GUY": "Guyana",
                            "HTI": "Haiti",
                            "HMD": "Heard Island and McDonald Islands",
                            "HND": "Honduras",
                            "HKG": "Hong Kong",
                            "HUN": "Hungary",
                            "ISL": "Iceland",
                            "IND": "India",
                            "IDN": "Indonesia",
                            "IRN": "Iran",
                            "IRQ": "Iraq",
                            "IRL": "Ireland",
                            "IMN": "Isle of Man",
                            "ISR": "Israel",
                            "ITA": "Italy",
                            "CIV": "Ivory Coast",
                            "JAM": "Jamaica",
                            "JPN": "Japan",
                            "JEY": "Jersey",
                            "JOR": "Jordan",
                            "KAZ": "Kazakhstan",
                            "KEN": "Kenya",
                            "KIR": "Kiribati",
                            "XKX": "Kosovo",
                            "KWT": "Kuwait",
                            "KGZ": "Kyrgyzstan",
                            "LAO": "Laos",
                            "LVA": "Latvia",
                            "LBN": "Lebanon",
                            "LSO": "Lesotho",
                            "LBR": "Liberia",
                            "LBY": "Libya",
                            "LIE": "Liechtenstein",
                            "LTU": "Lithuania",
                            "LUX": "Luxembourg",
                            "MAC": "Macao",
                            "MKD": "Macedonia",
                            "MDG": "Madagascar",
                            "MWI": "Malawi",
                            "MYS": "Malaysia",
                            "MDV": "Maldives",
                            "MLI": "Mali",
                            "MLT": "Malta",
                            "MHL": "Marshall Islands",
                            "MTQ": "Martinique",
                            "MRT": "Mauritania",
                            "MUS": "Mauritius",
                            "MYT": "Mayotte",
                            "MEX": "Mexico",
                            "FSM": "Micronesia",
                            "MDA": "Moldova",
                            "MCO": "Monaco",
                            "MNG": "Mongolia",
                            "MNE": "Montenegro",
                            "MSR": "Montserrat",
                            "MAR": "Morocco",
                            "MOZ": "Mozambique",
                            "MMR": "Myanmar",
                            "NAM": "Namibia",
                            "NRU": "Nauru",
                            "NPL": "Nepal",
                            "NLD": "Netherlands",
                            "ANT": "Netherlands Antilles",
                            "NCL": "New Caledonia",
                            "NZL": "New Zealand",
                            "NIC": "Nicaragua",
                            "NER": "Niger",
                            "NGA": "Nigeria",
                            "NIU": "Niue",
                            "NFK": "Norfolk Island",
                            "PRK": "North Korea",
                            "MNP": "Northern Mariana Islands",
                            "NOR": "Norway",
                            "OMN": "Oman",
                            "PAK": "Pakistan",
                            "PLW": "Palau",
                            "PSE": "Palestinian Territory",
                            "PAN": "Panama",
                            "PNG": "Papua New Guinea",
                            "PRY": "Paraguay",
                            "PER": "Peru",
                            "PHL": "Philippines",
                            "PCN": "Pitcairn",
                            "POL": "Poland",
                            "PRT": "Portugal",
                            "PRI": "Puerto Rico",
                            "QAT": "Qatar",
                            "COG": "Republic of the Congo",
                            "REU": "Reunion",
                            "ROU": "Romania",
                            "RUS": "Russia",
                            "RWA": "Rwanda",
                            "BLM": "Saint Barthelemy",
                            "SHN": "Saint Helena",
                            "KNA": "Saint Kitts and Nevis",
                            "LCA": "Saint Lucia",
                            "MAF": "Saint Martin",
                            "SPM": "Saint Pierre and Miquelon",
                            "VCT": "Saint Vincent and the Grenadines",
                            "WSM": "Samoa",
                            "SMR": "San Marino",
                            "STP": "Sao Tome and Principe",
                            "SAU": "Saudi Arabia",
                            "SEN": "Senegal",
                            "SRB": "Serbia",
                            "SCG": "Serbia and Montenegro",
                            "SYC": "Seychelles",
                            "SLE": "Sierra Leone",
                            "SGP": "Singapore",
                            "SXM": "Sint Maarten",
                            "SVK": "Slovakia",
                            "SVN": "Slovenia",
                            "SLB": "Solomon Islands",
                            "SOM": "Somalia",
                            "ZAF": "South Africa",
                            "SGS": "South Georgia and the South Sandwich Islands",
                            "KOR": "South Korea",
                            "SSD": "South Sudan",
                            "ESP": "Spain",
                            "LKA": "Sri Lanka",
                            "SDN": "Sudan",
                            "SUR": "Suriname",
                            "SJM": "Svalbard and Jan Mayen",
                            "SWZ": "Swaziland",
                            "SWE": "Sweden",
                            "CHE": "Switzerland",
                            "SYR": "Syria",
                            "TWN": "Taiwan",
                            "TJK": "Tajikistan",
                            "TZA": "Tanzania",
                            "THA": "Thailand",
                            "TGO": "Togo",
                            "TKL": "Tokelau",
                            "TON": "Tonga",
                            "TTO": "Trinidad and Tobago",
                            "TUN": "Tunisia",
                            "TUR": "Turkey",
                            "TKM": "Turkmenistan",
                            "TCA": "Turks and Caicos Islands",
                            "TUV": "Tuvalu",
                            "VIR": "U.S. Virgin Islands",
                            "UGA": "Uganda",
                            "UKR": "Ukraine",
                            "ARE": "United Arab Emirates",
                            "GBR": "United Kingdom",
                            "USA": "United States",
                            "UMI": "United States Minor Outlying Islands",
                            "URY": "Uruguay",
                            "UZB": "Uzbekistan",
                            "VUT": "Vanuatu",
                            "VAT": "Vatican",
                            "VEN": "Venezuela",
                            "VNM": "Vietnam",
                            "WLF": "Wallis and Futuna",
                            "ESH": "Western Sahara",
                            "YEM": "Yemen",
                            "ZMB": "Zambia",
                            "ZWE": "Zimbabwe"
                        }

                        d3.csv("data/power_plant_database.csv", function(err, data) {
                            /////////////////////////
                            // CONFIGURING THE MAP //
                            /////////////////////////

                            var config = {"data0":"latitude",
                                          "data1":"capacity_mw",
                                          "label0":"label 0", 
                                          "label1":"label 1", 
                                          "color0":"#99ccff", 
                                          "color1":"#0050A1",
                                          "width":1200,"height":960}

                            var width = config.width,
                                height = config.height;

                            ///////////////////////
                            // COLOURING THE MAP // 
                            ///////////////////////
                           
                            // var COLOR_COUNTS = 9;

                            // function Interpolate(start, end, steps, count) {
                            //     var s = start,
                            //         e = end,
                            //         final = s + (((e - s) / steps) * count);
                            //     return Math.floor(final);
                            // }

                            // function Color(_r, _g, _b) {
                            //     var r, g, b;
                            //     var setColors = function(_r, _g, _b) {
                            //         r = _r;
                            //         g = _g;
                            //         b = _b;
                            //     };

                            //     setColors(_r, _g, _b);
                            //     this.getColors = function() {
                            //         var colors = {
                            //             r: r,
                            //             g: g,
                            //             b: b
                            //         };
                            //         return colors;
                            //     };
                            // }

                            // function hexToRgb(hex) {
                            //     var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                            //     return result ? {
                            //         r: parseInt(result[1], 16),
                            //         g: parseInt(result[2], 16),
                            //         b: parseInt(result[3], 16)
                            //     } : null;
                            // }

                            // function valueFormat(d) {
                            //     if (d > 1000000000) {
                            //         return Math.round(d / 1000000000 * 10) / 10 + "B";
                            //     } else if (d > 1000000) {
                            //         return Math.round(d / 1000000 * 10) / 10 + "M";
                            //     } else if (d > 1000) {
                            //         return Math.round(d / 1000 * 10) / 10 + "K";
                            //     } else {
                            //         return d;
                            //     }
                            // }

                            // var COLOR_FIRST = config.color0, COLOR_LAST = config.color1;

                            // var rgb = hexToRgb(COLOR_FIRST);
                            // var COLOR_START = new Color(rgb.r, rgb.g, rgb.b);

                            // rgb = hexToRgb(COLOR_LAST);
                            // var COLOR_END = new Color(rgb.r, rgb.g, rgb.b);

                            // var startColors = COLOR_START.getColors(),
                            //     endColors = COLOR_END.getColors();

                            // var colors = [];

                            // for (var i = 0; i < COLOR_COUNTS; i++) {
                            //     var r = Interpolate(startColors.r, endColors.r, COLOR_COUNTS, i);
                            //     var g = Interpolate(startColors.g, endColors.g, COLOR_COUNTS, i);
                            //     var b = Interpolate(startColors.b, endColors.b, COLOR_COUNTS, i);
                            //     colors.push(new Color(r, g, b));
                            // }

                            // var MAP_KEY = config.data0;
                            // var MAP_VALUE = config.data1;

                            // color = d3.scaleSequentialQuantile([...data.values()], t => d3.interpolatePiYG(1 - t))
                            // legend = g => {
                            //     const width = 240;

                            //     g.append("image")
                            //         .attr("width", width)
                            //         .attr("height", 8)
                            //         .attr("preserveAspectRatio", "none")
                            //         .attr("xlink:href", ramp(color.interpolator()).toDataURL());

                            //     g.append("text")
                            //         .attr("class", "caption")
                            //         .attr("y", -6)
                            //         .attr("fill", "#000")
                            //         .attr("text-anchor", "start")
                            //         .attr("font-weight", "bold")
                            //         .text(data.title);

                            //     g.call(d3.axisBottom(d3.scalePoint(["lowest", "median", "highest"], [0, width]))
                            //         .tickSize(13))
                            //         .select(".domain")
                            //         .remove();
                            //     }

                            //////////////////////
                            // CREATING THE MAP //
                            //////////////////////

                            var projection = d3.geo.mercator()
                                .scale((width + 1) / 2 / Math.PI)
                                .translate([width / 2.15, height / 2])
                                .precision(.1);

                            var path = d3.geo.path()
                                .projection(projection);

                            var graticule = d3.geo.graticule();

                            // Defining the SVG canvas in which the map should appear on
                            var svg = d3.select("#canvas-svg").append("svg")
                                .attr("width", width)
                                .attr("height", height);

                            svg.append("path")
                                .datum(graticule)
                                .attr("class", "graticule")
                                .attr("d", path);
                            
                            
                            var valueHash = {};

                            function log10(val) {
                                return Math.log(val);
                            }

                            // data.forEach(function(d) {
                            //     valueHash[d[MAP_KEY]] = +d[MAP_VALUE];
                            // });

                            // var quantize = d3.scale.quantize()
                            //     .domain([0, 1.0])
                            //     .range(d3.range(COLOR_COUNTS).map(function(i) { return i }));

                            // quantize.domain([d3.min(data, function(d) {
                            //     return (+d[MAP_VALUE])}),
                            //     d3.max(data, function(d) {
                            //         return (+d[MAP_VALUE])})]);

                            d3.json("https://s3-us-west-2.amazonaws.com/vida-public/geo/world-topo-min.json", function(error, world) {
                            var countries = topojson.feature(world, world.objects.countries).features;

                            svg.append("path")
                                .datum(graticule)
                                .attr("class", "choropleth")
                                .attr("d", path);

                            var g = svg.append("g");

                            // svg.append("g")
                            //     .attr("transform", "translate(600,40)")
                            //     .call(legend);

                            // svg.append("g")
                            //     .selectAll("path")
                            //     .data(countries)
                            //     .join("path")
                            //     .attr("fill", d => color(data.get(d.id)))
                            //     .attr("d", path)
                            //     .append("title")
                            //     .text(d => `${data.get(d.id)}%`);

                            g.append("path")
                                .datum({type: "LineString", coordinates: [[-180, 0], [-90, 0], [0, 0], [90, 0], [180, 0]]})
                                .attr("class", "equator")
                                .attr("d", path);

                            svg.append("path")
                                // .datum(topojson.mesh(world, world.objects.countries, (a, b) => a !== b))
                                // .attr("fill", "none")
                                // .attr("stroke", "white")
                                // .attr("stroke-linejoin", "round")
                                .attr("d", path);

                            var country = g.selectAll(".country").data(countries);                        

                            country.enter().insert("path")
                                .attr("class", "country")
                                .attr("d", path)
                                .attr("id", function(d,i) { return d.id; })
                                .attr("title", function(d) { return d.properties.name; })
                                .style("fill", function(d) {
                                    if (valueHash[d.properties.name]) {
                                        var c = quantize((valueHash[d.properties.name]));
                                        var color = colors[c].getColors();
                                        return "rgb(" + color.r + "," + color.g + "," + color.b + ")";
                                    } else {
                                        return "#ccc";
                                    }
                                });
                                /*.on("mousemove", function(d) {
                                    var html = "";

                                    html += "<div class=\"tooltip_kv\">";
                                    html += "<span class=\"tooltip_key\">";
                                    html += Object.keys(d.properties) + '<br>';
                                    html += data.country_codes
                                    html += "</span>";
                                    html += "</div>";
                                    
                                    $("#tooltip-container").html(html);
                                    $(this).attr("fill-opacity", "0.8");
                                    $("#tooltip-container").show();
                                    
                                    var coordinates = d3.mouse(this);
                                    
                                    var map_width = $('.choropleth')[0].getBoundingClientRect().width;
                                    
                                    if (d3.event.pageX < map_width / 2) {
                                        d3.select("#tooltip-container")
                                        .style("top", (d3.event.layerY + 15) + "px")
                                        .style("left", (d3.event.layerX + 15) + "px");
                                    } else {
                                        var tooltip_width = $("#tooltip-container").width();
                                        d3.select("#tooltip-container")
                                        .style("top", (d3.event.layerY + 15) + "px")
                                        .style("left", (d3.event.layerX - tooltip_width - 30) + "px");
                                    }
                                })
                                .on("mouseout", function() {
                                        $(this).attr("fill-opacity", "1.0");
                                        $("#tooltip-container").hide();
                                    });*/
                            
                            g.append("path")
                                .datum(topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }))
                                .attr("class", "boundary")
                                .attr("d", path);
                            
                            // Plot power plant positions (sourced from https://codepen.io/jamesthomson/pen/wMzQYG?editors=1010)
                            function plotPoints(plants) {
                        

                            var locations = g.selectAll("circle")
                                .data(plants)
                                .enter()
                                .append("circle")
                                .attr("cx", function(d) {return projection([d.longitude, config.data0])[0];})
                                .attr("cy", function(d) {return projection([d.longitude, d.latitude])[1];})
                                .attr("r", 1)
                                .attr("class", "symbol")
                                .style("fill", function(d){
                                    if(d.fuel1 == "Oil" || d.fuel1 == "Nuclear" || d.fuel1 == "Gas" || d.fuel1 == "Coal") {
                                        return "red"
                                    }
                                    if(d.fuel1 == "Biomass" || d.fuel1 == "Geothermal" || d.fuel1 == "Hydro" || d.fuel1 == "Solar" || d.fuel1 == "Wind") {
                                        return "green"
                                    }
                                    if(d.fuel1 == "Other" || d.fuel1 == "Waste" ) {
                                        return "blue"
                                    }
                                })
                                .style("opacity", 0.8)
                                .on("mousemove", function(d) {
                                    var html = "";

                                    html += "<div class=\"tooltip_kv\">";
                                    html += "<span class=\"tooltip_key\">";
                                    if(d.name !== "") {
                                        html += d.name + "<br>";
                                    }
                                    if(d.commissioning_year !== "" ) {
                                     html += "Year Constructed: " + d.commissioning_year + "<br>";
                                    }
                                    if(d.owner !== "") {
                                        html += "Owner: " +d.owner + "<br>";
                                    }
                                    html += "Country: " + d.country_long + "<br>";
                                    html += "Main Fuel: " + d.fuel1 + "<br>";
                                    if(d.fuel2 !== "" && d.fuel3 !== "" ) {
                                     html += "Other Fuels: " + d.fuel2 + ", " + d.fuel3;
                                    } else
                                    if(d.fuel2 !== "" && d.fuel3 == "" ) {
                                     html += "Other Fuels: " + d.fuel2;
                                    } else
                                    if(d.fuel2 == "" && d.fuel3 !== "" ) {
                                     html += "Other Fuels: " + d.fuel3;
                                    }
                                    if(d.estimated_generation_gwh !== "") {
                                     html += "Estimated Annnual Electricity Generation (gigawatt hours): " + d.estimated_generation_gwh;
                                    }
                                    html += "</span>";
                                    html += "</div>";
                                    
                                    $("#tooltip-container").html(html);
                                    $(this).attr("fill-opacity", "0.8");
                                    $("#tooltip-container").show();
                                    
                                    var coordinates = d3.mouse(this);
                                    
                                    var map_width = $('.choropleth')[0].getBoundingClientRect().width;
                                    
                                    if (d3.event.pageX < map_width / 2) {
                                        d3.select("#tooltip-container")
                                        .style("top", (d3.event.layerY + 15) + "px")
                                        .style("left", (d3.event.layerX + 15) + "px");
                                    } else {
                                        var tooltip_width = $("#tooltip-container").width();
                                        d3.select("#tooltip-container")
                                        .style("top", (d3.event.layerY + 15) + "px")
                                        .style("left", (d3.event.layerX - tooltip_width - 30) + "px");
                                    }
                                })
                                .on("mouseout", function() {
                                        $(this).attr("fill-opacity", "1.0");
                                        $("#tooltip-container").hide();
                                    })
                                // still need to work this out
                                .on('click', function(d){
                                    if(d.url !== "" ) {
                                        var html = "";

                                        html += "<div class=\"tooltip_kv\">";
                                        html += "<span class=\"tooltip_key\">";
                                        html += "Country: " + d.country_long + "<br>";
                                        html += "Main Fuel: " + d.fuel1 + "<br>";
                                        if(d.url !== "" ) {
                                            html += '<a href="'+ d.url + '"></a>';

                                        }
                                        html += "</span>";
                                        html += "</div>";

                                    }
                                });
                                
                            }




                           
                                                        
                            var filterPlantsOther = data.filter(function(d){
                                    if(d["fuel1"] == "Other" || d["fuel1"] == "Waste") {
                                        return d
                                    }
                            })

                            var filterPlantsRenewable = data.filter(function(d){
                                    if(d["fuel1"] == "Biomass" || d["fuel1"] == "Hydro" || d["fuel1"] == "Geothermal" || d["fuel1"] == "Solar" || d["fuel1"] == "Wind" ) {
                                        return d
                                    }
                            })

                            var filterPlantsNonRenewable = data.filter(function(d){
                                    if(d["fuel1"] == "Oil" || d["fuel1"] == "Gas" || d["fuel1"] == "Coal" || d["fuel1"] == "Nuclear") {
                                        return d
                                    }
                            })

                            var filt_other_renew = data.filter(function(d){
                                    if(d["fuel1"] == "Other" || d["fuel1"] == "Waste" || d["fuel1"] == "Biomass" || d["fuel1"] == "Hydro" || d["fuel1"] == "Geothermal" || d["fuel1"] == "Solar" || d["fuel1"] == "Wind" ) {
                                        return d
                                    }
                            })

                            var filt_renew_non = data.filter(function(d){
                                if(d["fuel1"] == "Biomass" || d["fuel1"] == "Hydro" || d["fuel1"] == "Geothermal" || d["fuel1"] == "Solar" || d["fuel1"] == "Wind" || d["fuel1"] == "Oil" || d["fuel1"] == "Gas" || d["fuel1"] == "Coal" || d["fuel1"] == "Nuclear") {
                                        return d
                                    }
                            })

                            var filt_non_other = data.filter(function(d){
                                if(d["fuel1"] == "Oil" || d["fuel1"] == "Gas" || d["fuel1"] == "Coal" || d["fuel1"] == "Nuclear" || d["fuel1"] == "Other" || d["fuel1"] == "Waste") {
                                        return d
                                    }
                            })

                            var filt_all = data.filter(function(d){
                                if(d["fuel1"] == "Biomass" || d["fuel1"] == "Hydro" || d["fuel1"] == "Geothermal" || d["fuel1"] == "Solar" || d["fuel1"] == "Wind" || d["fuel1"] == "Oil" || d["fuel1"] == "Gas" || d["fuel1"] == "Coal" || d["fuel1"] == "Nuclear" || d["fuel1"] == "Other" || d["fuel1"] == "Waste") {
                                        return d
                                    }
                            })
                            plotPoints(filt_all)

                            
                   d3.selectAll(".filter_button").on("change", function() {
                                
                                var ticked_1 = false
                                var ticked_2 = false
                                var ticked_3 = false
                                g.selectAll('circle')
                                    .remove()
                                    // I *think* "inline" is the default.
                                if(document.getElementById('isselected1').checked) {
                                    ticked_1 = true

                                }


                                    // g.selectAll('circle')
                                    //     .remove()
                                

                                if(document.getElementById('isselected2').checked) {
                                    ticked_2 = true
                                } 

                                if(document.getElementById('isselected3').checked) {
                                    ticked_3 = true
                                } 


                                
                                // console.log('im here')
                                // console.log(ticked_1)
                                // console.log(ticked_2)



                                if (ticked_1 == true && ticked_2 == true && ticked_3 == true) {
                                    plotPoints(filt_all)
                                } else {
                                    if (ticked_1 == true && ticked_3 == true){
                                        plotPoints(filt_other_renew);
                                        console.log('ok')
                                    } else {
                                        if (ticked_2 == true && ticked_3 == true) {
                                            plotPoints(filt_non_other);
                                        } else {
                                            if (ticked_1 == true && ticked_2 == true) {
                                                plotPoints(filt_renew_non);
                                            } else {
                                                console.log('else')
                                                if (ticked_1 == true) {
                                                    plotPoints(filterPlantsRenewable);
                                                }
                                                if (ticked_2 == true) {
                                                    plotPoints(filterPlantsNonRenewable);
                                                    console.log("in ticked 2")
                                                }
                                                if (ticked_3 == true) {
                                                    plotPoints(filterPlantsOther);
                                                    console.log("in ticked 3")
                                                }
                                            }

                                        }
                                    }                                    
                                }

                            });

                            // plotPoints(data);








                            svg.attr("height", config.height * 2.2 / 3);
                            
                                //zoom and pan functionality (originally obtained from https://codepen.io/jamesthomson/pen/wMzQYG?editors=1010)
                                var zoom = d3.behavior.zoom()
                                    // Limits the zooming factor
                                    .scaleExtent([1, 50])
                                    .on("zoom",function() {
                                        // var t = svg.attr("transform", d3.event.transform);
                                        // svg.selectAll("circle").attr("transform", "scale(" + 1/t.k + ")");
                                        // console.log(t)

                                        // g.attr("transform","translate("+ 
                                        //     d3.event.translate.join(",")+")scale("+d3.event.scale+")");
                                        // g.selectAll("path")  
                                        //     .attr("d", path.projection(projection)); 

                                        // source: https://stackoverflow.com/questions/27460534/keep-d3-objects-size-constant-on-map-while-zoom-in-out
                                        g.attr("transform","translate("+ 
                                        d3.event.translate.join(",")+")scale("+d3.event.scale+")");
                                    g.selectAll("circle")
                                        .attr("d", path.projection(projection))
                                        .attr("r", 2/zoom.scale());
                                    g.selectAll("path")  
                                        .attr("d", path.projection(projection)); 
                                        
                                });
                                // zoom.on("zoom", function onZoomed() {

                                // })
                                svg.call(zoom); });


                        d3.select(self.frameElement).style("height", (height * 2.3 / 3) + "px");
                
                    });

                    </script>
                                 
            <!-- ***** Javascript End ***** -->
        </div>
    </section>


    <!-- ***** Footer Area (Copyright Text) ***** -->
    <footer class="footer-social-icon text-center section_padding_70 clearfix">       
        <!-- Foooter Text-->
        <div class="copyright-text">
            <!-- ***** Removing this text is now allowed! This template is licensed under CC BY 3.0 ***** -->
            <p>Copyright ©2017 Ca. Designed by <a href="https://colorlib.com" target="_blank">Colorlib</a></p>
        </div>
    </footer>


    <!-- Jquery-2.2.4 JS -->
    <script src="js/jquery-2.2.4.min.js"></script>
    <!-- Popper js -->
    <script src="js/popper.min.js"></script>
    <!-- Bootstrap-4 Beta JS -->
    <script src="js/bootstrap.min.js"></script>
    <!-- All Plugins JS -->
    <script src="js/plugins.js"></script>
    <!-- Slick Slider Js-->
    <script src="js/slick.min.js"></script>
    <!-- Footer Reveal JS -->
    <script src="js/footer-reveal.min.js"></script>
    <!-- Active JS -->
    <script src="js/active.js"></script>
</body>

</html>
